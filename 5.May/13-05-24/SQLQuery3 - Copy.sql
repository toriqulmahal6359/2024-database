CREATE TABLE #temp (	P_ID INT,	CV_Complete INT);WITH eduCTE AS (	SELECT DISTINCT P_ID	FROM bdjResumes..EDU AS e		INNER JOIN bdjResumes..userAccounts a on e.P_ID = a.accID	WHERE e.PASSING_YEAR >= 2014		 AND e.Edulevel = 4 and a.cvPosted = 1		 AND P_ID >= 5101 AND P_ID <= 7083030), CV_CTE AS (	SELECT e.P_ID, --MIN(e.P_ID), MAX(e.P_ID) 		Ph = CASE WHEN p.PhotoUploaded = 1 THEN 20 ELSE 0 END,		Ed = CASE WHEN ed.P_ID IS NOT NULL THEN 20 ELSE 0 END,		Tr = CASE WHEN t.P_ID IS NOT NULL THEN 5 ELSE 0 END,		Pr = CASE WHEN pd.P_ID IS NOT NULL THEN 5 ELSE 0 END,		Ex = CASE WHEN ex.P_ID IS NOT NULL THEN 20 ELSE 0 END,		Sp = CASE WHEN sp.P_ID IS NOT NULL THEN 5 ELSE 0 END,		Rf = CASE WHEN rf.P_ID IS NOT NULL THEN 5 ELSE 0 END,		CV = 20		--CV = CASE WHEN u.CVPosted = 1 THEN 20 END 	FROM eduCTE AS e 		INNER JOIN bdjResumes..PERSONAL AS p ON e.P_ID = p.ID 		LEFT JOIN (SELECT TOP 1 P_ID FROM bdjResumes..EDU AS ed WHERE e.P_ID = ed.P_ID)		LEFT JOIN bdjResumes..TRAINING AS t ON e.P_ID = t.P_ID		LEFT JOIN bdjResumes..PEDU AS pd ON e.P_ID = pd.P_ID		LEFT JOIN bdjResumes..EXP AS ex ON e.P_ID = ex.P_ID		LEFT JOIN bdjResumes..SPECIALIST AS sp ON e.P_ID = sp.P_ID		LEFT JOIN bdjResumes..REF AS rf ON e.P_ID = rf.P_ID		--WHERE p.ID >= 5101 AND p.ID <= 7083030		--LEFT JOIN bdjResumes..UserAccounts AS u ON p.ID = u.accID)--, completeCV_CTE AS (INSERT INTO #temp (P_ID, CV_Complete) 	SELECT P_ID,		(Ph + Ed + Tr + Pr  + Ex + Sp + Rf + CV) AS [CV_Complete]	FROM CV_CTE--)--DROP TABLE #temp--; WITH Intermediate_CTE as (--	SELECT --		e.ID, [CV_Complete]--		, CASE WHEN P.ApplyID is not null then 1 ELse 0 END [Shortlisted]--	FROM completeCV_CTE AS e--		LEFT JOIN bdjCorporate..DBO_JOB_INBOX AS j ON e.ID = j.P_ID--		LEFT JOIN bdjCorporate.rp.ApplicantProcess AS p ON j.ApplyID = p.ApplyId AND p.LevelStatus = 1--)SELECT 	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 90 AND e.[CV_Complete] <= 100 THEN e.P_ID END) AS [90-100 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 90 AND e.[CV_Complete] <= 100 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [90-100 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 80 AND e.[CV_Complete] <= 90 THEN e.P_ID END) AS [80-90 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 80 AND e.[CV_Complete] <= 90  AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [80-90 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 70 AND e.[CV_Complete] <= 80 THEN e.P_ID END) AS [70-80 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 70 AND e.[CV_Complete] <= 80 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [70-80 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 60 AND e.[CV_Complete] <= 70 THEN e.P_ID END) AS [60-70 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 60 AND e.[CV_Complete] <= 70 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [60-70 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 50 AND e.[CV_Complete] <= 60 THEN e.P_ID END) AS [50-60 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] >= 50 AND e.[CV_Complete] <= 60 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [50-60 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] <= 50 THEN e.P_ID END) AS [Below 50 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] <= 50 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [Below 50 Percent Shortlisted]FROM #temp eLEFT JOIN bdjCorporate..DBO_JOB_INBOX AS j ON e.P_ID = j.P_IDLEFT JOIN bdjCorporate.rp.ApplicantProcess AS p ON j.ApplyID = p.ApplyId AND p.LevelStatus = 1
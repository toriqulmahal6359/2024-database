declare @StartDateOfYear smalldatetime = '1/25/2022', @EndDateOfYear smalldatetime = '1/25/2023'	; with Personal_CTE AS (	select distinct p.id as P_ID 	from bdjResumes..Personal p 		inner join bdjResumes..UserAccounts a on p.id=a.accid 	where ((p.Posting_date>=@StartDateOfYear and p.Updated_Date is null) or p.Updated_date>=@StartDateOfYear) and p.Posting_date<@EndDateOfYear and accisactivate=1 and a.CVPosted=1	), CV_CTE AS (	Select p.id As P_ID, 		case when p.PhotoUploaded =  1 then 20 end as photo, 		E=case when (select top 1 ed_id from Edu where P_ID=p.ID) > 0 then 20 end, 		T=case when (select top 1 t_id from TRAINING where P_ID=p.ID) > 0 then 5 end, 		P=case when (select top 1 pe_id from PEdu where P_ID=p.ID) > 0 then 5 end , 		X= case when (select top 1 ex_id from [EXP] where P_ID=p.ID) > 0 then 20 end,		S=case when (select top 1 p_id from SPECIALIST where P_ID=p.ID) > 0 then 5 end, 		R=case when (select top 1 r_id from REF where P_ID=p.ID) > 0 then 5 end,		case when ac.CVPosted = 1 then 20 end personal, ac.accCatId AS CAT_ID	From PERSONAL p		Left Join PersonalExtras pe on p.Id=pe.p_id	LEFT Join useraccounts ac on p.id=ac.accid	WHERE  p.id IN (SELECT P_ID FROM Personal_CTE)	), Completeness_CTE AS (	SELECT P_ID, CASE WHEN ((CAT_ID >= 1 AND CAT_ID < 60) OR CAT_ID = -10) THEN 1 WHEN (CAT_ID > 60 OR CAT_ID = -11) THEN 2 END AS [CV CAT]	, (CASE WHEN photo IS NULL THEN 0 ELSE photo END)+(CASE WHEN E IS NULL THEN 0 ELSE E END)+(CASE WHEN T IS NULL THEN 0 ELSE T END)+(CASE WHEN P IS NULL THEN 0 ELSE P END) +(CASE WHEN X IS NULL THEN 0 ELSE X END)  +(CASE WHEN S IS NULL THEN 0 ELSE S END)+(CASE WHEN R IS NULL THEN 0 ELSE R END)+(CASE WHEN personal IS NULL THEN 0 ELSE personal END)  as Completeness	from CV_CTE	)	SELECT 	COUNT(CASE WHEN Completeness < 31 AND [CV CAT] = 1 THEN P_ID END) AS [0-30 White Collar], 	COUNT(CASE WHEN Completeness < 31 AND [CV CAT] = 2 THEN P_ID END) AS [0-30 Blue Collar]	, COUNT(CASE WHEN Completeness > 30 AND Completeness < 51 AND [CV CAT] = 1 THEN P_ID END) AS [31-50 White Collar]	, COUNT(CASE WHEN Completeness > 30 AND Completeness < 51  AND [CV CAT] = 2 THEN P_ID END) AS [31-50 Blue Collar]	, COUNT(CASE WHEN Completeness > 50 AND Completeness < 71 AND [CV CAT] = 1  THEN P_ID END) AS [51-70 White Collar]	, COUNT(CASE WHEN Completeness > 50 AND Completeness < 71  AND [CV CAT] = 2  THEN P_ID END) AS [51-70 Blue Collar]	, COUNT(CASE WHEN Completeness > 70 AND Completeness < 100 AND [CV CAT] = 1 THEN P_ID END) AS [71-100 White Collar]	, COUNT(CASE WHEN Completeness > 70 AND Completeness < 100 AND [CV CAT] = 2 THEN P_ID END) AS [71-100 Blue Collar]	, COUNT(CASE WHEN Completeness = 100 AND [CV CAT] = 1 THEN P_ID END) AS [100 White Collar]	, COUNT(CASE WHEN Completeness = 100 AND [CV CAT] = 2 THEN P_ID END) AS [100 Blue Collar]	FROM Completeness_CTE
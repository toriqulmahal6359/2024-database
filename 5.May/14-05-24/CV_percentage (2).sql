drop table #tempCREATE TABLE #temp (	P_ID INT,	CV_Complete INT);WITH eduCTE AS (	SELECT Distinct P_ID	FROM bdjResumes..EDU AS e		INNER JOIN bdjResumes..userAccounts a on e.P_ID = a.accID	WHERE e.PASSING_YEAR >= 2014		 AND e.Edulevel = 4 and a.cvPosted = 1 and e.P_ID >= 5101 AND e.P_ID <= 7083030), CV_CTE AS (	SELECT p.ID,		Ph = CASE WHEN p.PhotoUploaded = 1 THEN 20 END,		Ed = 20,		Tr = CASE WHEN t.P_ID is not null THEN 5 END,		--CASE WHEN (SELECT TOP 1 T_ID FROM bdjResumes..TRAINING WHERE e.P_ID = P_ID) > 0 THEN 5 END,		Pr = CASE WHEN (SELECT TOP 1 Pe_ID FROM bdjResumes..PEDU WHERE e.p_ID = P_ID) > 0 THEN 5 END,		Ex = CASE WHEN (SELECT TOP 1 Ex_ID FROM bdjResumes..EXP WHERE e.P_ID = P_ID) > 0 THEN 20 END,		Sp = CASE WHEN (SELECT TOP 1 P_ID FROM bdjResumes..SPECIALIST WHERE e.P_ID = P_ID) > 0 THEN 5 END,		Rf = CASE WHEN (SELECT TOP 1 R_ID FROM bdjResumes..REF WHERE e.P_ID = P_ID) > 0 THEN 5 END,		CV = 20	FROM eduCTE AS e 		INNER JOIN bdjResumes..PERSONAL AS p ON e.P_ID = p.ID		left join bdjResumes..TRAINING t on e.p_id = t.P_ID		--left JOIN bdjResumes..PEDU pe on e.P_ID = t.p)--, completeCV_CTE AS (INSERT INTO #temp (P_ID, CV_Complete) 	SELECT ID,		(CASE WHEN Ph IS NULL THEN 0 ELSE Ph END) + (CASE WHEN Ed IS NULL THEN 0 ELSE Ed END) + (CASE WHEN Tr IS NULL THEN 0 ELSE Tr END) +		(CASE WHEN Pr IS NULL THEN 0 ELSE Pr END) + (CASE WHEN Ex IS NULL THEN 0 ELSE Ex END) + (CASE WHEN Sp IS NULL THEN 0 ELSE Sp END) +		(CASE WHEN Rf IS NULL THEN 0 ELSE Rf END) + (CASE WHEN CV IS NULL THEN 0 ELSE CV END) AS [CV_Complete]	FROM CV_CTE--)SELECT 	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 90 AND e.[CV_Complete] <= 100 THEN e.P_ID END) AS [90-100 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 90 AND e.[CV_Complete] <= 100 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [90-100 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 80 AND e.[CV_Complete] <= 90 THEN e.P_ID END) AS [80-90 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 80 AND e.[CV_Complete] <= 90  AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [80-90 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 70 AND e.[CV_Complete] <= 80 THEN e.P_ID END) AS [70-80 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 70 AND e.[CV_Complete] <= 80 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [70-80 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 60 AND e.[CV_Complete] <= 70 THEN e.P_ID END) AS [60-70 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 60 AND e.[CV_Complete] <= 70 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [60-70 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 50 AND e.[CV_Complete] <= 60 THEN e.P_ID END) AS [50-60 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] > 50 AND e.[CV_Complete] <= 60 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [50-60 Percent Shortlisted],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] <= 50 THEN e.P_ID END) AS [Below 50 Percent],	COUNT(DISTINCT CASE WHEN e.[CV_Complete] <= 50 AND p.ApplyId IS NOT NULL THEN e.P_ID END) AS [Below 50 Percent Shortlisted]FROM #temp eLEFT JOIN bdjCorporate..DBO_JOB_INBOX AS j ON e.P_ID = j.P_IDLEFT JOIN bdjCorporate.rp.ApplicantProcess AS p ON j.ApplyID = p.ApplyId AND p.LevelStatus = 1
SELECT     p_id,    MAX(CASE WHEN rn = 1 AND (CAST(ETO AS varchar(11)) = '1900-01-01 00:00:00' OR ETO IS NULL) AND SERVE_TILL = 1 THEN CAST(EFROM AS varchar(11)) END) AS currentExp_sdate,	MAX(CASE WHEN rn = 1 THEN Eto END) AS currentExp_edate,	MAX(CASE WHEN rn = 1 AND (CAST(ETO AS varchar(11)) = '1900-01-01 00:00:00' OR ETO IS NULL) AND SERVE_TILL = 1  THEN company END) AS orgname1,	MAX(CASE WHEN rn = 1 AND (CAST(ETO AS varchar(11)) = '1900-01-01 00:00:00' OR ETO IS NULL) AND SERVE_TILL = 1  THEN eposition END) AS designation1,    MAX(CASE WHEN rn = 2 THEN Efrom END) AS Experience2_sdate,	MAX(CASE WHEN rn = 2 THEN Eto END) AS Experience2_edate,	MAX(CASE WHEN rn = 2 THEN company END) AS orgname2,	MAX(CASE WHEN rn = 2 THEN eposition END) AS designation2,    MAX(CASE WHEN rn = 3 THEN Efrom END) AS Experience3_sdate,	MAX(CASE WHEN rn = 3 THEN Eto END) AS Experience3_edate,	MAX(CASE WHEN rn = 3 THEN company END) AS orgname3,	MAX(CASE WHEN rn = 3 THEN eposition END) AS designation3,    MAX(CASE WHEN rn = 4 THEN Efrom END) AS Experience4_sdate,	MAX(CASE WHEN rn = 4 THEN Eto END) AS Experience4_edate,	MAX(CASE WHEN rn = 4 THEN company END) AS orgname4,	MAX(CASE WHEN rn = 4 THEN eposition END) AS designation4,	MAX(CASE WHEN rn = 5 THEN Efrom END) AS Experience5_sdate,	MAX(CASE WHEN rn = 5 THEN Eto END) AS Experience5_edate,	MAX(CASE WHEN rn = 5 THEN company END) AS orgname5,	MAX(CASE WHEN rn = 5 THEN eposition END) AS designation5FROM (    SELECT         e.p_id,		e.company,		e.eposition,        e.Efrom,		e.eto,		e.SERVE_TILL,        ROW_NUMBER() OVER (PARTITION BY e.p_id ORDER BY e.Efrom DESC) AS rn    FROM  bdjResumes..EXP e 	where P_ID = 418393) AS subqueryGROUP BY p_idSELECT * FROM bdjResumes..EXP WHERE P_ID = 418393SELECT * FROM bdjResumes..EXP WHERE P_ID = 545652 --1117713 --762216 --826313with person as (SELECT DISTINCT P_ID FROM bdjCorporate..DBO_JOB_INBOX WHERE JP_ID = 1236811),final as (SELECT     p_id,    MAX(CASE WHEN rn = 1 and ETO is null THEN Efrom else null END) AS currentExp_sdate,	MAX(CASE WHEN rn = 1  and ETO is null THEN company else null END) AS orgname1,	MAX(CASE WHEN rn = 1 and ETO is null THEN eposition else null END) AS designation1,    MAX(CASE WHEN rn = 2 THEN Efrom END) AS Experience2_sdate,	MAX(CASE WHEN rn = 2 THEN Eto END) AS Experience2_edate,	MAX(CASE WHEN rn = 2 THEN company END) AS orgname2,	MAX(CASE WHEN rn = 2 THEN eposition END) AS designation2,    MAX(CASE WHEN rn = 3 THEN Efrom END) AS Experience3_sdate,	MAX(CASE WHEN rn = 3 THEN Eto END) AS Experience3_edate,	MAX(CASE WHEN rn = 3 THEN company END) AS orgname3,	MAX(CASE WHEN rn = 3 THEN eposition END) AS designation3,    MAX(CASE WHEN rn = 4 THEN Efrom END) AS Experience4_sdate,	MAX(CASE WHEN rn = 4 THEN Eto END) AS Experience4_edate,	MAX(CASE WHEN rn = 4 THEN company END) AS orgname4,	MAX(CASE WHEN rn = 4 THEN eposition END) AS designation4FROM (    SELECT         e.p_id,		e.company,		e.eposition,        e.Efrom,		e.eto,        ROW_NUMBER() OVER (PARTITION BY e.p_id ORDER BY e.Efrom DESC) AS rn    FROM exp e	inner join person p on e.P_ID = p.P_ID) AS subqueryGROUP BY  p_id)select *from final
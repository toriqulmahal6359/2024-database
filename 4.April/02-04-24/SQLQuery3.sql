WITH jobCTE AS (	SELECT J.JP_ID, j.PublishDate AS [Publish Date] , COUNT(ji.Applyid) AS [Total Applied] 	FROM bdjCorporate..DBO_JOBPOSTINGS AS j	LEFT JOIN  bdjCorporate..DBO_JOB_INBOX AS ji ON j.JP_ID = ji.JP_ID	WHERE CONVERT(DATE, j.PublishDate, 101) > '11/29/2023'	GROUP BY j.JP_ID,j.PublishDate), proApplyCount AS (	SELECT j.JP_ID,j.[Publish Date],j.[Total Applied], COUNT(DISTINCT ji.P_ID) AS [Total Pro Applied] 	FROM jobCTE AS j 	INNER JOIN bdjCorporate..DBO_JOB_INBOX AS ji ON j.JP_ID = ji.JP_ID	INNER JOIN bdjResumes.[dbo].[OnlinePaymentInfoJS] AS o ON o.P_ID = ji.P_ID	WHERE o.ServiceID IN (87, 88, 89) AND o.TransStatus = 'S'	GROUP BY j.JP_ID,j.[Publish Date],j.[Total Applied]), totalShortlisted AS (	SELECT j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied], 	COUNT(DISTINCT CASE WHEN ji.P_ID IS NOT NULL THEN s.ApplyId END) AS [Total Shortlisted]	--COUNT(DISTINCT CASE WHEN o.P_ID IS NOT NULL THEN ji.ApplyID END) AS [Total Pro Shortlisted] 	FROM proApplyCount AS j 	INNER JOIn bdjCorporate..DBO_JOB_INBOX AS ji ON ji.JP_ID = j.JP_ID	--INNER JOIN bdjResumes.mnt.CandidatePackages AS o ON o.P_ID = ji.P_ID	INNER JOIN bdjCorporate.[rp].[ApplicantProcess] AS s ON s.ApplyId = ji.ApplyID	GROUP BY j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied])	SELECT j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied],j.[Total Shortlisted], COUNT(DISTINCT ji.ApplyID) AS [Total Pro Shortlisted] 	FROM totalShortlisted AS j 	INNER JOIN bdjCorporate..DBO_JOB_INBOX AS ji ON ji.JP_ID = j.JP_ID	INNER JOIN bdjResumes.mnt.CandidatePackages AS o ON o.P_ID = ji.P_ID	INNER JOIN bdjCorporate.[rp].[ApplicantProcess] AS s ON s.ApplyId = ji.ApplyID	--WHERE j.JP_ID = 1220308	GROUP BY  j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied],j.[Total Shortlisted]		--SELECT TOP 5 * FROM bdjResumes.mnt.CandidatePackages  
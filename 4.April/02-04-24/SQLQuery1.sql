WITH jobCTE AS (	SELECT J.JP_ID, j.PublishDate AS [Publish Date], COUNT(ji.Applyid) AS [Total Applied] 	FROM bdjCorporate..DBO_JOBPOSTINGS AS j	INNER JOIN  bdjCorporate..DBO_JOB_INBOX AS ji ON j.JP_ID = ji.JP_ID	WHERE CONVERT(DATE, j.PublishDate, 101) > '11/29/2023'	GROUP BY j.JP_ID,j.PublishDate), proApplyCount AS (	SELECT j.JP_ID,j.[Publish Date],j.[Total Applied], 	--COUNT(DISTINCT ji.P_ID) AS [Total Pro Applied]	COUNT(DISTINCT CASE WHEN(ji.P_DATE >= c.cpkStartDate AND ji.P_DATE <= DATEADD(MONTH, c.cpkDuration, c.cpkStartDate)) THEN ji.P_ID END) AS [Total Pro Applied] 	FROM jobCTE AS j 	INNER JOIN bdjCorporate..DBO_JOB_INBOX AS ji ON j.JP_ID = ji.JP_ID	LEFT JOIN bdjResumes.mnt.CandidatePackages AS c ON c.P_ID = ji.P_ID	INNER JOIN bdjResumes.[dbo].[OnlinePaymentInfoJS] AS o ON o.P_ID = ji.P_ID AND o.SysID = c.cpkId	WHERE o.ServiceID IN (87, 88, 89) AND o.TransStatus = 'S'	GROUP BY j.JP_ID,j.[Publish Date],j.[Total Applied])	SELECT j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied] 	,COUNT(distinct s.ApplyId) AS [Total Shortlisted]	--COUNT(DISTINCT CASE WHEN ji.P_DATE >= o.cpkStartDate AND ji.P_DATE <= DATEADD(MONTH, o.cpkDuration, o.cpkStartDate) THEN s.ApplyId END) AS [Total Shortlisted] 	, COUNT(DISTINCT case when c.P_ID is not null AND (ji.P_DATE >= c.cpkStartDate AND ji.P_DATE <= DATEADD(MONTH, c.cpkDuration, c.cpkStartDate)) then s.ApplyId end) AS [Total Pro Shortlisted] 	FROM proApplyCount AS j 	INNER JOIn bdjCorporate..DBO_JOB_INBOX AS ji ON ji.JP_ID = j.JP_ID	LEFT JOIN bdjResumes.mnt.CandidatePackages AS c ON c.P_ID = ji.P_ID	--INNER JOIN bdjResumes.[dbo].[OnlinePaymentInfoJS] AS o ON o.P_ID = ji.P_ID AND o.SysID = c.cpkId	INNER JOIN bdjCorporate.[rp].[ApplicantProcess] AS s ON s.ApplyId = ji.ApplyID	--WHERE o.ServiceID IN (87, 88, 89) AND o.TransStatus = 'S'	GROUP BY j.JP_ID,j.[Publish Date],j.[Total Applied],j.[Total Pro Applied]WITH jobCTE AS (	SELECT J.JP_ID, j.PublishDate AS [Publish Date], COUNT(ji.Applyid) AS [Total Applied] 	FROM bdjCorporate..DBO_JOBPOSTINGS AS j	LEFT JOIN  bdjCorporate..DBO_JOB_INBOX AS ji ON j.JP_ID = ji.JP_ID	WHERE CONVERT(DATE, j.PublishDate, 101) > '11/29/2023'	GROUP BY j.JP_ID,j.PublishDate)SELECT j.JP_ID, j.[Publish Date], j.[Total Applied], COUNT(DISTINCT ji.ApplyID) AS [Total Shortlisted] FROM jobCTE AS jINNER JOIN bdjCorporate..DBO_JOB_INBOX AS ji ON ji.JP_ID = j.JP_IDLEFT JOIN bdjResumes.mnt.CandidatePackages AS c ON c.P_ID = ji.P_IDINNER JOIN bdjResumes.[dbo].[OnlinePaymentInfoJS] AS o ON o.P_ID = ji.P_ID AND o.SysID = c.cpkIdWHERE o.ServiceID IN (87, 88, 89) AND o.TransStatus = 'S'GROUP BY j.JP_ID. j.[Publish Date], j.[Total Applied]